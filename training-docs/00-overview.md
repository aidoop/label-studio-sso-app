# Label Studio SSO 프로젝트 종합 개요

## 목차
1. [프로젝트 소개](#1-프로젝트-소개)
2. [프로젝트 관계도](#2-프로젝트-관계도)
3. [각 프로젝트별 역할](#3-각-프로젝트별-역할)
4. [기술 스택 요약](#4-기술-스택-요약)
5. [주요 기능 요약](#5-주요-기능-요약)
6. [문서 가이드](#6-문서-가이드)

---

## 1. 프로젝트 소개

이 프로젝트는 **Label Studio**를 기업 환경에서 SSO(Single Sign-On) 인증과 함께 사용할 수 있도록 커스터마이징한 시스템입니다.

### 1.1 프로젝트 목적

- **SSO 통합**: 기업의 기존 인증 시스템과 Label Studio 연동
- **권한 제어**: 어노테이션 소유권 기반 접근 제어
- **MLOps 통합**: 커스텀 Export API로 ML 파이프라인 연동
- **iframe 임베딩**: 외부 애플리케이션에 Label Studio 통합

### 1.2 대상 사용자

| 역할 | 관심 영역 |
|------|----------|
| **백엔드 개발자** | Django 커스터마이징, API 확장 |
| **프론트엔드 개발자** | Vue.js SSO 통합, iframe 임베딩 |
| **DevOps 엔지니어** | Docker, Kubernetes 배포 |
| **ML 엔지니어** | Export API, Webhook 통합 |
| **시스템 관리자** | 사용자 관리, 보안 설정 |

---

## 2. 프로젝트 관계도

### 2.1 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         전체 시스템 아키텍처                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐
│  label-studio-sso    │  ← Python 패키지 (PyPI: label-studio-sso v6.0.8)
│  (SSO 미들웨어)       │     - JWT 인증 백엔드
│                      │     - Django Session 변환
└──────────┬───────────┘     - 자동 로그인 미들웨어
           │
           │ pip install (Docker build 시)
           ▼
┌──────────────────────┐
│  label-studio-custom │  ← Docker 이미지 (ghcr.io)
│  (커스텀 이미지)       │     - Base: heartexlabs/label-studio:1.20.0
│                      │     - label-studio-sso 통합
│  v1.20.0-sso.44      │     - 커스텀 API 추가
└──────────┬───────────┘     - UI 커스터마이징
           │
           │ docker pull (Docker Compose에서)
           ▼
┌──────────────────────┐
│  label-studio-sso-app│  ← 샘플 애플리케이션 (Vue 3 + Express.js)
│  (샘플 앱)            │     - SSO 통합 데모
│                      │     - 웹훅 모니터링
│  v1.0.10             │     - API 테스트 UI
└──────────────────────┘
```

### 2.2 데이터 흐름도

```
┌─────────────┐     ┌─────────────┐     ┌─────────────────┐     ┌────────────┐
│   사용자     │────▶│  Vue 3 앱   │────▶│  Express.js     │────▶│  Label     │
│  (Browser)  │     │  (Frontend) │     │  (Backend)      │     │  Studio    │
└─────────────┘     └─────────────┘     └─────────────────┘     └────────────┘
                           │                     │                      │
                           │  iframe             │  API 호출            │
                           │  (Label Studio)     │  (JWT 발급)          │
                           │                     │                      │
                           └─────────────────────┴──────────────────────┘
                                          │
                                          ▼
                                   ┌────────────┐
                                   │ PostgreSQL │
                                   │  Database  │
                                   └────────────┘
```

### 2.3 인증 흐름도

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              인증 흐름                                       │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────┐        ┌─────────┐        ┌─────────────┐        ┌─────────────┐
  │ Browser │        │ Express │        │   Label     │        │ label-studio│
  │         │        │   .js   │        │   Studio    │        │    -sso     │
  └────┬────┘        └────┬────┘        └──────┬──────┘        └──────┬──────┘
       │                  │                    │                      │
       │  1. 로그인 요청   │                    │                      │
       │─────────────────▶│                    │                      │
       │                  │                    │                      │
       │                  │  2. JWT 토큰 요청   │                      │
       │                  │───────────────────▶│                      │
       │                  │                    │                      │
       │                  │  3. JWT 토큰 반환   │                      │
       │                  │◀───────────────────│                      │
       │                  │                    │                      │
       │  4. JWT 쿠키 설정 │                    │                      │
       │◀─────────────────│                    │                      │
       │                  │                    │                      │
       │  5. iframe 로드 (JWT 쿠키 포함)        │                      │
       │──────────────────────────────────────▶│                      │
       │                  │                    │                      │
       │                  │                    │  6. JWT 검증          │
       │                  │                    │─────────────────────▶│
       │                  │                    │                      │
       │                  │                    │  7. 세션 생성         │
       │                  │                    │◀─────────────────────│
       │                  │                    │                      │
       │  8. 세션 쿠키 + 페이지 반환            │                      │
       │◀──────────────────────────────────────│                      │
       │                  │                    │                      │
```

---

## 3. 각 프로젝트별 역할

### 3.1 프로젝트 비교표

| 항목 | label-studio-sso | label-studio-custom | label-studio-sso-app |
|------|------------------|---------------------|----------------------|
| **타입** | Python 패키지 | Docker 이미지 | 웹 애플리케이션 |
| **역할** | SSO 미들웨어 | 커스텀 Label Studio | 샘플/데모 앱 |
| **기술** | Django, JWT | Django, DRF | Vue 3, Express.js |
| **버전** | v6.0.8 | v1.20.0-sso.44 | v1.0.10 |
| **배포** | PyPI | GHCR | GHCR |

### 3.2 label-studio-sso (SSO 미들웨어)

**목적**: Label Studio에 JWT 기반 SSO 인증 기능 추가

**주요 컴포넌트**:
- `JWTAuthenticationBackend`: JWT 토큰 검증 및 사용자 인증
- `JWTAutoLoginMiddleware`: 자동 로그인 및 세션 변환
- `SSO Token API`: JWT 토큰 발급 엔드포인트

**핵심 기능**:
```python
# JWT → Django Session 변환 (성능 최적화)
1. 첫 요청: JWT 검증 → Django 세션 생성 → JWT 쿠키 삭제
2. 이후 요청: Django 세션으로 빠른 인증
```

### 3.3 label-studio-custom (커스텀 이미지)

**목적**: Label Studio를 기업 환경에 맞게 커스터마이징

**주요 커스터마이징**:
| 기능 | 설명 | 파일 |
|------|------|------|
| SSO 통합 | JWT 미들웨어 설정 | `config/label_studio.py` |
| hideHeader | iframe 헤더 숨김 | `custom-templates/base.html` |
| 어노테이션 소유권 | 본인만 수정 가능 | `custom-permissions/` |
| Custom Export API | MLOps 필터링 | `custom-api/export.py` |
| Admin API | 유저 관리 | `custom-api/admin_users.py` |
| Webhook 확장 | 사용자 정보 추가 | `scripts/patch_webhooks.py` |

### 3.4 label-studio-sso-app (샘플 앱)

**목적**: SSO 통합 방법을 보여주는 참조 구현

**주요 기능**:
- SSO 로그인 데모
- 실시간 Webhook 모니터링
- 커스텀 API 테스트 UI
- 유저 관리 인터페이스

---

## 4. 기술 스택 요약

### 4.1 백엔드 기술

```
┌─────────────────────────────────────────────────────────────┐
│                      백엔드 스택                             │
├─────────────────────────────────────────────────────────────┤
│  Label Studio Core                                          │
│  ├── Django 4.x (웹 프레임워크)                              │
│  ├── Django REST Framework (API)                            │
│  ├── PostgreSQL (데이터베이스)                               │
│  └── Gunicorn (WSGI 서버)                                   │
├─────────────────────────────────────────────────────────────┤
│  SSO 확장                                                   │
│  ├── label-studio-sso (JWT 미들웨어)                        │
│  ├── PyJWT (JWT 처리)                                       │
│  └── Django Session (세션 관리)                             │
├─────────────────────────────────────────────────────────────┤
│  샘플 앱 백엔드                                              │
│  ├── Node.js 18 (런타임)                                    │
│  ├── Express.js (웹 프레임워크)                              │
│  ├── CORS (크로스 오리진)                                    │
│  └── Cookie Parser (쿠키 처리)                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 프론트엔드 기술

```
┌─────────────────────────────────────────────────────────────┐
│                      프론트엔드 스택                          │
├─────────────────────────────────────────────────────────────┤
│  Label Studio Frontend                                       │
│  ├── React (UI 프레임워크)                                   │
│  ├── MobX (상태 관리)                                        │
│  └── Webpack (번들러)                                        │
├─────────────────────────────────────────────────────────────┤
│  샘플 앱 프론트엔드                                           │
│  ├── Vue 3 (UI 프레임워크)                                   │
│  ├── Vite (빌드 도구)                                        │
│  └── Composition API (상태 관리)                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 인프라 기술

```
┌─────────────────────────────────────────────────────────────┐
│                      인프라 스택                             │
├─────────────────────────────────────────────────────────────┤
│  컨테이너화                                                  │
│  ├── Docker (컨테이너 런타임)                                │
│  ├── Docker Compose (로컬 오케스트레이션)                    │
│  └── Multi-stage Build (이미지 최적화)                       │
├─────────────────────────────────────────────────────────────┤
│  오케스트레이션                                              │
│  ├── Kubernetes (프로덕션 오케스트레이션)                    │
│  ├── Kustomize (환경별 설정)                                 │
│  └── AWS ALB (로드 밸런서)                                   │
├─────────────────────────────────────────────────────────────┤
│  CI/CD                                                      │
│  ├── GitHub Actions (자동화)                                 │
│  ├── GHCR (컨테이너 레지스트리)                              │
│  └── Semantic Versioning (버전 관리)                         │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 주요 기능 요약

### 5.1 인증 기능

| 기능 | 설명 | 구현 위치 |
|------|------|----------|
| JWT 인증 | 토큰 기반 인증 | label-studio-sso |
| 세션 변환 | JWT → Django Session | label-studio-sso |
| 자동 로그인 | 미들웨어 기반 | label-studio-sso |
| 사용자 전환 | 충돌 없는 전환 | label-studio-sso-app |

### 5.2 권한 기능

| 기능 | 설명 | 구현 위치 |
|------|------|----------|
| 어노테이션 소유권 | 본인만 수정 | label-studio-custom |
| 관리자 API | 유저 생성/승격 | label-studio-custom |
| CSRF 보호 | 토큰 검증 | Django 내장 |

### 5.3 API 확장

| API | 엔드포인트 | 설명 |
|-----|-----------|------|
| Custom Export | `POST /api/custom/export/` | MLOps용 필터링 |
| Admin Users | `POST /api/admin/users/*` | 유저 관리 |
| SSO Token | `GET /api/sso/token` | JWT 발급 |
| Version | `GET /api/version` | 커스텀 버전 정보 |

### 5.4 UI 커스터마이징

| 기능 | 설명 | 구현 방법 |
|------|------|----------|
| hideHeader | 헤더 숨김 | URL 파라미터 + CSS |
| Date Filter | 날짜 필터 UI | JavaScript 주입 |
| Import 숨김 | Import 버튼 제거 | CSS + JS |

---

## 6. 문서 가이드

### 6.1 문서 구성

| 문서 | 내용 | 대상 |
|------|------|------|
| [00-overview.md](./00-overview.md) | 프로젝트 개요 (현재 문서) | 전체 |
| [01-label-studio-architecture.md](./01-label-studio-architecture.md) | Label Studio 구조 | 백엔드 개발자 |
| [02-customization-methodology.md](./02-customization-methodology.md) | 커스터마이징 방법론 | 백엔드 개발자 |
| [03-sso-implementation.md](./03-sso-implementation.md) | SSO 구현 방법 | 전체 |
| [04-deployment-guide.md](./04-deployment-guide.md) | 배포 가이드 | DevOps |
| [05-development-guide.md](./05-development-guide.md) | 개발 가이드 | 개발자 |

### 6.2 학습 경로

**초급 (1-2일)**:
1. 00-overview.md 읽기
2. 로컬 환경 설정 (05-development-guide.md)
3. 샘플 앱 실행 및 테스트

**중급 (3-5일)**:
1. Label Studio 아키텍처 이해 (01)
2. 커스터마이징 방법론 학습 (02)
3. SSO 구현 방법 학습 (03)

**고급 (1주+)**:
1. 커스텀 API 개발 실습
2. 새로운 기능 추가
3. 프로덕션 배포 (04)

---

## 부록: 버전 정보

### 현재 버전 (2025년 12월 기준)

| 컴포넌트 | 버전 | 릴리스 날짜 |
|---------|------|------------|
| Label Studio (Base) | 1.20.0 | - |
| label-studio-sso | 6.0.8 | - |
| label-studio-custom | 1.20.0-sso.44 | 2025-12-11 |
| label-studio-sso-app | 1.0.10 | 2025-12-11 |

### 버전 명명 규칙

```
label-studio-custom 버전 형식:
<Label Studio 버전>-sso.<빌드 번호>

예시: 1.20.0-sso.44
- 1.20.0: 베이스 Label Studio 버전
- sso: SSO 커스터마이징 표시
- 44: 커스텀 빌드 번호
```

---

## 다음 단계

1. [Label Studio 아키텍처](./01-label-studio-architecture.md)로 진행하여 기본 구조를 이해하세요.
2. 또는 [개발 가이드](./05-development-guide.md)로 바로 실습 환경을 구성하세요.
